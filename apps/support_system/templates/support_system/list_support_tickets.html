  <!--
  ~ Copyright (c) 2024 BMD™ Autonomous Holdings. All rights reserved.
  ~
  ~ Project: Bimod.io™
  ~ File: list_support_tickets.html
  ~ Last Modified: 2024-10-05 01:39:48
  ~ Author: Ege Dogan Dursun (Co-Founder & Chief Executive Officer / CEO @ BMD™ Autonomous Holdings)
  ~ Created: 2024-10-05 14:42:41
  ~
  ~ This software is proprietary and confidential. Unauthorized copying,
  ~ distribution, modification, or use of this software, whether for
  ~ commercial, academic, or any other purpose, is strictly prohibited
  ~ without the prior express written permission of BMD™ Autonomous
  ~ Holdings.
  ~
  ~  For permission inquiries, please contact: admin@Bimod.io.
  ~
  -->

{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Support Tickets{% endblock %}

{% block vendor_css %}
  {{ block.super }}
<link rel="stylesheet" href="{% static 'vendor/libs/datatables-bs5/datatables.bootstrap5.css' %}"/>
  <link rel="stylesheet" href="{% static 'vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css' %}"/>
  <link rel="stylesheet" href="{% static 'vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css' %}"/>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.7.2/font/bootstrap-icons.min.css">
{% endblock vendor_css %}

{% block vendor_js %}
  {{ block.super }}
  <script src="{% static 'vendor/libs/datatables-bs5/datatables-bootstrap5.js' %}"></script>
  <script src="{% static 'vendor/libs/sweetalert2/sweetalert2.js' %}"></script>
{% endblock vendor_js %}

{% block page_js %}
  {{ block.super }}
  <script src="{% static 'js/support-ticket-list.js' %}"></script>
{% endblock page_js %}

{% block content %}
  <div class="row g-6 mb-6">
    <div class="col-sm-6 col-xl-3">
      <h3 class="mb-0">
        <i class="fa fa-hands-helping me-4"></i>
        <strong>
          Support Tickets
        </strong></h3>
    </div>
    <!-- Add more statistics cards if necessary -->
  </div>

  <div class="card">
    <div class="card-header border-bottom">
      <div class="tips-section alert alert-secondary alert-dismissible d-flex col-lg-12 align-items-center" role="alert">
        <img src="{% static 'img/custom-illustrations-v2/i2-2.png' %}" width="25%" style="border-radius: 25px;"
             class="justify-content-end me-8" alt="Illustration for tip">
        <span class="alert-icon rounded">
        <i class="ti ti-bookmark"></i>
      </span>
        <div class="d-flex flex-column ps-1">
          <h5 class="alert-heading mb-2">Tip</h5>
          <p class="mb-0">
            In this page, you can view all the support tickets you have created. You can track the updates in the ticket
          status and priority. As there will be updates in the ticket status, you can view the ticket details and
          communicate with the support team by using the comments section.
          </p>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
          </button>
        </div>
      </div>
      <img src="{% static 'img/support_tickets/spt-1.png' %}" class="rounded mt-4 mb-4" style="width: 100%;" alt="Illustration for tips">
    </div>

    {% if messages %}
      {% for message in messages %}
        <div
          class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% else %}alert-danger{% endif %}"
          role="alert">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <div class="card-datatable table-responsive p-8 mt-4">
      <a href="{% url 'support_system:create' %}">
        <button class="btn btn-success ms-4 mb-4">
          <i class="fa fa-add me-4"></i>
          <strong>Create New Ticket</strong>
        </button>
      </a>
      <table class="datatables-tickets table">
        <thead class="border-top">
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Status</th>
          <th>Priority</th>
          <th>Created At</th>
          <th>Updated At</th>
          <th></th>
        </tr>
        </thead>
        <tbody>
        {% for ticket in page_obj %}
          <tr>
            <td>{{ ticket.id }}</td>
            <td><a href="{% url 'support_system:detail' ticket.id %}"><strong>{{ ticket.title }}</strong></a></td>
            <td>
              {% if ticket.get_status_display == "Open" %}
                <i class="fa fa-circle text-warning me-2"></i>
              {% elif ticket.get_status_display == "In Progress" %}
                <i class="fa fa-briefcase-clock text-info me-2"></i>
              {% elif ticket.get_status_display == "Resolved" %}
                <i class="fa fa-circle text-success me-2"></i>
              {% elif ticket.get_status_display == "Closed" %}
                <i class="fa fa-circle text-secondary me-2"></i>
              {% endif %}
              <strong>{{ ticket.get_status_display }}</strong>
            </td>
            <td>
              {% if ticket.get_priority_display == "Recommendation" %}
                <i class="fa fa-lightbulb text-success me-2"></i>
              {% elif ticket.get_priority_display == "Low" %}
                <i class="fa fa-temperature-1 text-success me-2"></i>
              {% elif ticket.get_priority_display == "Medium" %}
                <i class="fa fa-temperature-2 text-info me-2"></i>
              {% elif ticket.get_priority_display == "High" %}
                <i class="fa fa-temperature-3 text-warning me-2"></i>
              {% elif ticket.get_priority_display == "Critical" %}
                <i class="fa fa-temperature-4 text-danger me-2"></i>
              {% endif %}
              <strong>{{ ticket.get_priority_display }}</strong>
            </td>
            <td>{{ ticket.created_at|date:"Y-m-d H:i" }}</td>
            <td>{{ ticket.updated_at|date:"Y-m-d H:i" }}</td>
            <td>
              <a href="{% url 'support_system:detail' ticket.id %}" class="btn btn-sm btn-primary">
                <i class="bi bi-eye me-2"></i>
                <strong>View</strong>
              </a>
            </td>
          </tr>
        {% empty %}
          <div class="alert alert-warning p-8 m-4" role="alert">
            <div class="">
              <i class="fa fa-exclamation-triangle me-4"></i>
              <strong>No support tickets have been created yet.</strong>
            </div>
          </div>
        {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination controls -->
    <nav aria-label="Page navigation">
      <ul class="pagination pagination-rounded pb-4 overflow-auto justify-content-center">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page=1" aria-label="First">
              <i class="bi bi-chevron-double-left"></i>
            </a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
              <i class="bi bi-chevron-left"></i>
            </a>
          </li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
          {% if page_obj.number == num %}
            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
          {% elif num > page_obj.number|add:'-5' and num < page_obj.number|add:'5' %}
            <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
          {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
              <i class="bi bi-chevron-right"></i>
            </a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" aria-label="Last">
              <i class="bi bi-chevron-double-right"></i>
            </a>
          </li>
        {% endif %}
      </ul>
    </nav>
  </div>
{% endblock %}
