  <!--
  ~ Copyright (c) 2024 BMD™ Autonomous Holdings. All rights reserved.
  ~
  ~ Project: Br6.in™
  ~ File: list_custom_functions.html
  ~ Last Modified: 2024-10-05 01:39:48
  ~ Author: Ege Dogan Dursun (Co-Founder & Chief Executive Officer / CEO @ BMD™ Autonomous Holdings)
  ~ Created: 2024-10-05 14:42:40
  ~
  ~ This software is proprietary and confidential. Unauthorized copying,
  ~ distribution, modification, or use of this software, whether for
  ~ commercial, academic, or any other purpose, is strictly prohibited
  ~ without the prior express written permission of BMD™ Autonomous
  ~ Holdings.
  ~
  ~  For permission inquiries, please contact: admin@br6.in.
  ~
  -->

{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Custom Functions{% endblock %}

{% block vendor_css %}
  {{ block.super }}
<link rel="stylesheet" href="{% static 'vendor/libs/datatables-bs5/datatables.bootstrap5.css' %}"/>
  <link rel="stylesheet" href="{% static 'vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css' %}"/>
  <link rel="stylesheet" href="{% static 'vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css' %}"/>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.7.2/font/bootstrap-icons.min.css">
{% endblock vendor_css %}

{% block vendor_js %}
  {{ block.super }}
  <script src="{% static 'vendor/libs/datatables-bs5/datatables-bootstrap5.js' %}"></script>
{% endblock vendor_js %}

{% block page_js %}
  {{ block.super }}
  <script src="{% static 'js/custom-functions-list.js' %}"></script>
{% endblock page_js %}

{% block content %}
  <div class="row g-6 mb-6">
    <div class="col-sm-6 col-xl-3">
      <h3 class="mb-0">
        <strong>Custom Functions</strong>
      </h3>
    </div>
  </div>

  <div class="tips-section alert alert-secondary alert-dismissible d-flex col-lg-12 align-items-center" role="alert">
    <img src="{% static 'img/custom-illustrations-v2/i2-23.png' %}" width="25%" style="border-radius: 25px;"
         class="justify-content-end me-8" alt="Illustration for tip">
    <span class="alert-icon rounded ms-4">
    <i class="ti ti-bookmark"></i>
  </span>
    <div class="d-flex flex-column ps-1">
      <h5 class="alert-heading mb-2">Tip</h5>
      <p class="mb-0">
        Use the search box to find specific functions by name or description. Please note that these are the internal
        functions created by you or anyone in your organization. To use these functions in your assistants, you need to
        connect them to the assistant. You can also delete the functions if you no longer need them.
      </p>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
      </button>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div
        class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% else %}alert-danger{% endif %}"
        role="alert">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <hr>

  <!-- Search and Filter Form -->
  <div class="row g-4 mb-4 mt-8 card card-border-shadow-primary p-4">
    <div class="col-xl-12">
      <h5 class="text-muted"><strong>Filter Functions</strong></h5>
      <div class="card text-center mb-4">
        <div class="card-header">
          <div class="nav-align-top">
            <form method="get" action=".">
              <div class="input-group mb-3">
                <input type="text" name="search" value="{{ request.GET.search }}" class="form-control"
                       placeholder="Search by name or description">
                <button type="submit" class="btn btn-primary"><strong>Search</strong></button>
                <a href="." class="btn btn-secondary"><strong>Clear</strong></a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Custom Functions List Table -->
  <div class="card">
    <div class="card-header">
      <h5 class="card-title">
        <strong>Internal Function Library</strong>
      </h5>
    </div>
    <div class="card-datatable table-responsive">
      <a href="{% url 'mm_functions:create' %}">
        <button class="btn btn-success ms-4 mb-8">
          <i class="fa fa-plus me-4"></i>
          <strong> Design New Function</strong>
        </button>
      </a>
      <a href="{% url 'mm_functions:connect' %}">
        <button class="btn btn-info ms-4 mb-8">
          <i class="fa fa-chain me-4"></i>
          <strong> Manage Connections</strong>
        </button>
      </a>
      <a href="{% url 'mm_functions:store' %}">
        <button class="btn btn-warning ms-4 mb-8">
          <i class="fa fa-store me-4"></i>
          <strong> Function Store</strong>
        </button>
      </a>
      <table class="table datatables-custom-functions">
        <thead class="border-top">
        <tr>
          <th></th>
          <th></th>
          <th>Name</th>
          <th>Creator</th>
          <th>Description</th>
          <th>Packages</th>
          <th>Input Fields</th>
          <th>Output Fields</th>
          <th>Scope</th>
          <th></th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for function in page_obj %}
          <tr>
            <td></td>
            <td>
              <img src="
                {% if function.function_picture %}{{ function.function_picture.url }}{% else %}{% static 'img/avatars/org-0.png' %}{% endif %}"
                   alt="{{ function.name }}" class="avatar rounded">
            </td>
            <td style="min-width: 200px;"><strong>{{ function.name }}</strong></td>
            <td><strong>{{ function.created_by_user }}</strong></td>
            <td style="min-width: 300px;">{{ function.description }}</td>
            <td>
              <div class="label bg-label-dark rounded p-2 overflow-scroll" style="min-height: 200px; max-height: 200px;">
                {% for package in function.packages %}
                  <div class="badge bg-light text-dark m-1">
                    {{ package.name }}{% if package.version %} ({{ package.version }}){% endif %}
                  </div>
                {% endfor %}
              </div>
            </td>
            <td>
              <ul class="list-unstyled" style="font-size: 10px;">
                <div class="label bg-label-dark rounded p-2 overflow-scroll" style="min-height: 200px; max-height: 200px;">
                  {% for input in function.input_fields %}
                    <li class="badge bg-label-secondary rounded m-1 w-100">
                      <p class="label bg-label-light text-dark rounded p-1 m-1">
                        <strong>{{ input.name }}</strong>: {{ input.description|truncatechars:64 }}</p>
                      <p class="label bg-label-light text-dark rounded p-1 m-1"><strong>Type:</strong> {{ input.type }}
                      </p>
                      <p class="label bg-label-light text-dark rounded p-1 m-1">
                        <strong>Required:</strong> {{ input.required }}</p>
                    </li>
                  {% endfor %}
                </div>
              </ul>
            </td>
            <td>
              <ul class="list-unstyled" style="font-size: 10px;">
                <div class="label bg-label-dark rounded p-2 overflow-scroll" style="min-height: 200px; max-height: 200px;">
                  {% for output in function.output_fields %}
                    <li class="badge bg-label-secondary rounded m-1 w-100">
                      <p class="label bg-label-light text-dark rounded p-1 m-1">
                        <strong>{{ output.name }}</strong>: {{ output.description|truncatechars:64 }}</p>
                      <p class="label bg-label-light text-dark rounded p-1 m-1"><strong>Type:</strong> {{ output.type }}
                      </p>
                    </li>
                  {% endfor %}
                </div>
              </ul>
            </td>
            <td>
              {% if function.is_public %}
                <span class="border border-success rounded py-1 px-1 w-100"><strong>PUBLIC</strong></span>
              {% else %}
                <span class="border border-danger rounded py-1 px-1 w-100"><strong>PRIVATE</strong></span>
              {% endif %}
            </td>
            <td>
              <a href="{% url 'mm_functions:connect' %}" class="btn btn-label-success"><i
                class="bi bi-code-square me-2"></i><strong>Connect Assistant(s)</strong></a>
            </td>
            <td>
              <a href="{% url 'mm_functions:delete' function.pk %}" class="btn btn-label-danger"><i
                class="bi bi-trash me-2"></i><strong>Delete</strong></a>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      <!-- Pagination Controls -->
      <nav aria-label="Page navigation">
        <ul class="pagination pagination-rounded overflow-auto m-4 pb-4">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}"><i
                class="bi bi-chevron-double-left"></i></a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page=
                {{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"><i
                class="bi bi-chevron-left"></i></a>
            </li>
          {% endif %}
          {% for page_num in page_obj.paginator.page_range %}
            <li class="page-item {% if page_obj.number == page_num %}active{% endif %}">
              <a class="page-link" href="?page=
                {{ page_num }}{% if search_query %}&search={{ search_query }}{% endif %}">{{ page_num }}</a>
            </li>
          {% endfor %}
          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link"
                 href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"><i
                class="bi bi-chevron-right"></i></a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page=
                {{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}"><i
                class="bi bi-chevron-double-right"></i></a>
            </li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </div>
{% endblock %}
