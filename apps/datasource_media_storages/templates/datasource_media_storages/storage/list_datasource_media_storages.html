  <!--
  ~ Copyright (c) 2024 BMD™ Autonomous Holdings. All rights reserved.
  ~
  ~ Project: Jupi.tr™
  ~ File: list_datasource_media_storages.html
  ~ Last Modified: 2024-10-01 23:45:03
  ~ Author: Ege Dogan Dursun (Co-Founder & Chief Executive Officer / CEO @ BMD™ Autonomous Holdings)
  ~ Created: 2024-10-05 01:36:46
  ~
  ~ This software is proprietary and confidential. Unauthorized copying,
  ~ distribution, modification, or use of this software, whether for
  ~ commercial, academic, or any other purpose, is strictly prohibited
  ~ without the prior express written permission of BMD™ Autonomous
  ~ Holdings.
  ~
  ~  For permission inquiries, please contact: admin@jupi.tr.
  ~
  -->

{% extends layout_path %}

{% load static %}
{% load i18n %}
{% load field_to_label %}

{% block title %}Media Storage Connections{% endblock %}

{% block vendor_css %}
  {{ block.super }}
<link rel="stylesheet" href="{% static 'vendor/libs/flatpickr/flatpickr.css' %}"/>
  <link rel="stylesheet" href="{% static 'vendor/libs/select2/select2.css' %}"/>
  <style>
    .text-wrap {
      white-space: normal;
      word-break: break-all;
    }
  </style>
{% endblock vendor_css %}

{% block vendor_js %}
  {{ block.super }}
  <script src="{% static 'vendor/libs/cleavejs/cleave.js' %}"></script>
  <script src="{% static 'vendor/libs/cleavejs/cleave-phone.js' %}"></script>
  <script src="{% static 'vendor/libs/moment/moment.js' %}"></script>
  <script src="{% static 'vendor/libs/flatpickr/flatpickr.js' %}"></script>
  <script src="{% static 'vendor/libs/select2/select2.js' %}"></script>
{% endblock vendor_js %}

{% block page_js %}
  {{ block.super }}
  <script src="{% static 'js/form-layouts.js' %}"></script>
{% endblock page_js %}

{% block content %}
  <div class="row g-6 mb-6">
    <div class="col-sm-6 col-xl-6">
      <h3 class="mb-0"><strong>Media Storage Connections</strong></h3>
    </div>
  </div>

  <div class="tips-section alert alert-secondary alert-dismissible d-flex col-lg-12 align-items-center" role="alert">
    <img src="{% static 'img/custom-illustrations-v2/i2-60.png' %}" width="25%" style="border-radius: 25px;"
         class="justify-content-end me-8" alt="Illustration for tip">
    <span class="alert-icon rounded">
    <i class="ti ti-bookmark"></i>
  </span>
    <div class="d-flex flex-column ps-1">
      <h5 class="alert-heading mb-2">Tip</h5>
      <p class="mb-0">
        In this page, you can manage your media storage connections for your assistants. You must be aware of the fact
        that the media storage connections are assistant-based. This means that the assistants will be able to use
        the media storages that you have created here, and if you want another assistant to use the same media storage,
        you need to create another connection for that assistant.
      </p>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div
        class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% else %}alert-danger{% endif %}"
        role="alert">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <hr>

  <!-- Media Storage Connections Cards -->
  {% for org_data in data %}
    <div class="card mb-6">
      <div class="card-header border-bottom">
        <div class="d-flex">
          <img src="
            {% if org_data.organization.organization_image %}{{ org_data.organization.organization_image.url }}{% else %}{% static 'img/avatars/org-0.png' %}{% endif %}"
               class="rounded me-4" width="60" height="60" alt="Organization image">
          <h4>{{ org_data.organization.name }}</h4>
        </div>
        <div class="card-datatable table-responsive">
          <a href="{% url 'datasource_media_storages:create' %}">
            <button class="btn btn-success mt-8 mb-8">
              <i class="fa fa-add me-4"></i>
              <strong> Add New Media Storage</strong>
            </button>
          </a>
        </div>
      </div>
      <div class="card-body">
        {% for assistant_data in org_data.assistants %}
          <div class="assistant-group m-8 card card-border-shadow-primary p-4">
            <div class="d-flex">
              <img src="
                {% if assistant_data.assistant.assistant_image %}{{ assistant_data.assistant.assistant_image.url }}{% else %}{% static 'img/avatars/org-0.png' %}{% endif %}"
                   class="rounded me-4 mb-8" width="60" height="60" alt="Assistant image">
              <h5 class="assistant-title ms-4"><strong>
                {{ assistant_data.assistant.name }}
              </strong></h5>
            </div>
            <div class="row g-6 mb-4">
              {% for storage_data in assistant_data.media_storages %}
                <div class="col-xl-6 col-md-6">
                  <div class="card h-100">
                    <div class="card-header d-flex justify-content-between">
                      <div class="card-title mb-0">
                        <p class="card-subtitle mb-4"><strong>
                          <i class="fa fa-id-badge me-4"></i> Connection Name: &nbsp;&nbsp;</strong>
                          {{ storage_data.storage.name }}
                        </p>
                        <p class="card-subtitle mb-1"><strong>
                          <i class="fa fa-database me-4"></i> Media Category: &nbsp;&nbsp;</strong>
                          {{ storage_data.storage.get_media_category_display }}
                        </p>
                      </div>
                    </div>
                    <hr>
                    <div class="card-body">
                      <ul class="p-0 m-0">
                        <li class="mb-4 d-flex justify-content-between align-items-center">
                          <span class="text-body" style="min-width: 120px;"><strong>
                            <i class="fa fa-info-circle me-4"></i>
                            Description:
                          </strong></span>
                          <span class="text-wrap">{{ storage_data.storage.description|linebreaksbr }}</span>
                        </li>
                        <li class="mb-4 d-flex justify-content-between align-items-center">
                          <span class="text-body" style="min-width: 120px;"><strong>
                            <i class="fa fa-folder me-4"></i>
                            Path:
                          </strong></span>
                          <span
                            class="text-wrap bg-label-warning p-2 rounded ms-4"><strong>{{ storage_data.storage.directory_full_path }}</strong></span>
                        </li>
                      </ul>
                      <hr>
                      <div class="d-flex justify-content-center">
                        <a href="{% url 'datasource_media_storages:update' storage_data.storage.id %}"
                           class="btn btn-primary me-3"><i class="ti ti-edit me-2"></i><strong>Edit Connection</strong></a>
                        <a href="{% url 'datasource_media_storages:delete' storage_data.storage.id %}"
                           class="btn btn-danger"><i class="ti ti-trash me-2"></i><strong>Delete Connection</strong></a>
                      </div>
                    </div>
                  </div>
                </div>
              {% empty %}
                <div class="alert alert-warning p-4 ms-4 w-75" role="alert">
                  <div class="">
                    <i class="fa fa-exclamation-triangle me-4"></i>
                    <strong>No Media Storage found for this assistant.</strong>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
          <hr>
        {% empty %}
          <div class="alert alert-warning p-4 ms-4 w-75" role="alert">
            <div class="">
              <i class="fa fa-exclamation-triangle me-4"></i>
              <strong>No Media Storage found for this organization.</strong>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endfor %}

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll('.toggle-icon').forEach(function (icon) {
        icon.addEventListener('click', function () {
          var target = document.querySelector(this.getAttribute('data-target'));
          var bootstrapCollapse = new bootstrap.Collapse(target, {
            toggle: false
          });
          if (target.classList.contains('show')) {
            bootstrapCollapse.hide();
          } else {
            bootstrapCollapse.show();
          }
        });
      });

      document.querySelectorAll('.collapse').forEach(function (collapse) {
        collapse.addEventListener('show.bs.collapse', function () {
          var icon = document.querySelector(`.toggle-icon[data-target="#${this.id}"]`);
          if (icon) {
            icon.classList.remove('fa-arrow-alt-circle-down');
            icon.classList.add('fa-arrow-alt-circle-up');
          }
        });

        collapse.addEventListener('hide.bs.collapse', function () {
          var icon = document.querySelector(`.toggle-icon[data-target="#${this.id}"]`);
          if (icon) {
            icon.classList.remove('fa-arrow-alt-circle-up');
            icon.classList.add('fa-arrow-alt-circle-down');
          }
        });
      });
    });
  </script>

{% endblock %}
