<!--
  ~ Copyright (c) 2024 BMD™ Autonomous Holdings. All rights reserved.
  ~
  ~ Project: Bimod.io™
  ~ File: detail_hadron_topic.html
  ~ Last Modified: 2024-10-18 00:16:58
  ~ Author: Ege Dogan Dursun (Co-Founder & Chief Executive Officer / CEO @ BMD™ Autonomous Holdings)
  ~ Created: 2024-10-18 00:16:58
  ~
  ~ This software is proprietary and confidential. Unauthorized copying,
  ~ distribution, modification, or use of this software, whether for
  ~ commercial, academic, or any other purpose, is strictly prohibited
  ~ without the prior express written permission of BMD™ Autonomous
  ~ Holdings.
  ~
  ~  For permission inquiries, please contact: admin@Bimod.io.
  ~
  -->

{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Hadron Topic Details{% endblock %}

{% block vendor_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'vendor/libs/sweetalert2/sweetalert2.css' %}" />
{% endblock vendor_css %}

{% block vendor_js %}
  {{ block.super }}
  <script src="{% static 'vendor/libs/sweetalert2/sweetalert2.js' %}"></script>
{% endblock vendor_js %}

{% block page_js %}
  <script>
    // Function to show confirmation dialog before purging publishing logs
    function confirmPurgeTopicMessages() {
      Swal.fire({
        title: 'Are you sure?',
        text: 'This will delete all topic messages, and you won\'t be able to revert this action.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, purge them!',
        cancelButtonText: 'No, cancel!',
        customClass: {
          confirmButton: 'btn btn-danger me-2 waves-effect waves-light',
          cancelButton: 'btn btn-label-secondary waves-effect waves-light'
        },
        buttonsStyling: false
      }).then((result) => {
        if (result.isConfirmed) {
          document.getElementById('purge-publishing-logs-form').submit();
        }
      });
    }
  </script>
{% endblock page_js %}

{% block content %}
  <div class="row">
    <div class="col-xl mb-6">
      <div class="card">
        <div class="card-header justify-content-between align-items-center">
          <h4 class="mb-0"><strong>
            <i class="fa fa-robot me-4 mt-4"></i>
            Hadron Topic Logs
          </strong></h4>
          <h6 class="">
            <strong>
              <i class="fa fa-bookmark me-4 mt-4"></i>
              {{ hadron_topic.topic_name }}
            </strong>
          </h6>
          <h6>
            <strong>
              <i class="fa fa-lightbulb me-4 mt-0"></i>
              {% if hadron_topic.get_topic_category_display == 'Alerts' %}
                <span class="btn-danger p-2 rounded"><strong>Alerts</strong></span>
              {% elif hadron_topic.get_topic_category_display == 'Info' %}
                <span class="btn-warning p-2 rounded"><strong>Info</strong></span>
              {% elif hadron_topic.get_topic_category_display == 'States' %}
                <span class="btn-primary p-2 rounded"><strong>States</strong></span>
              {% elif hadron_topic.get_topic_category_display == 'Measurements' %}
                <span class="btn-info p-2 rounded"><strong>Measurements</strong></span>
              {% elif hadron_topic.get_topic_category_display == 'Actions' %}
                <span class="btn-success p-2 rounded"><strong>Actions</strong></span>
              {% elif hadron_topic.get_topic_category_display == 'Commands' %}
                <span class="btn-dark p-2 rounded"><strong>Commands</strong></span>
              {% else %}
                <span class="btn-secondary p-2 rounded"><strong>Unknown</strong></span>
              {% endif %}
            </strong>
          </h6>
          <hr>
          <a href="{% url 'hadron_prime:detail_hadron_system' pk=hadron_topic.system.id %}"
             class="btn btn-secondary mt-4">
            <i class="fa fa-arrow-left me-2"></i>
            <strong>Back to System Details</strong>
          </a>
          <a href="{% url 'hadron_prime:detail_hadron_topic' pk=hadron_topic.id %}">
            <button class="btn btn-success ms-4 mt-4">
              <i class="fa fa-refresh me-4"></i>
              <strong>Refresh</strong>
            </button>
          </a>
          <a href="{% url 'hadron_prime:update_hadron_topic' pk=hadron_topic.id %}">
            <button class="btn btn-warning ms-4 mt-4">
              <i class="fa fa-edit me-4"></i>
              <strong>Update Hadron Topic</strong>
            </button>
          </a>
          <a href="{% url 'hadron_prime:delete_hadron_topic' pk=hadron_topic.id %}">
            <button class="btn btn-danger ms-4 mt-4">
              <i class="fa fa-trash me-4"></i>
              <strong>Delete Hadron Topic</strong>
            </button>
          </a>
        </div>
        <div class="card-body">
          <div class="tips-section alert alert-secondary alert-dismissible d-flex col-lg-12 align-items-center"
               role="alert">
            <img src="{% static 'img/custom-illustrations-v2/i2-37.png' %}" width="25%" style="border-radius:25px;"
                 class="justify-content-end me-8" alt="Illustration for logs">
            <span class="alert-icon rounded">
              <i class="ti ti-bookmark"></i>
            </span>
            <div class="d-flex flex-column ps-1">
              <h5 class="alert-heading mb-2">Logs</h5>
              <p class="mb-0">
                This page shows the logs for the selected Hadron Topic. The logs are ordered chronologically, with the
                most recent log displayed at the top.
              </p>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
              </button>
            </div>
          </div>

          <hr>

          <div class="table-responsive">
            <a class="mt-4">
              <button class="btn btn-danger mb-8 mt-2 w-25" onclick="confirmPurgeTopicMessages()">
                <i class="fa fa-skull-crossbones me-2"></i><strong>Purge Topic Messages</strong>
              </button>
            </a>
            <hr>
            <img src="{% static 'img/hadron_prime/had-6.png' %}" class="rounded mt-0" style="width: 100%;"
                 alt="Illustration for tips">
            <hr>
            <form id="purge-publishing-logs-form" method="post"
                  action="{% url 'hadron_prime:delete_all_messages' pk=hadron_topic.id %}">
              {% csrf_token %}
            </form>
            <table class="table table-striped table-bordered">
              <thead>
              <tr>
                <th>Timestamp</th>
                <th>Sender Node</th>
                <th>Message</th>
              </tr>
              </thead>
              <tbody>
              {% for message in page_obj %}
                <tr>
                  <td style="min-width: 200px; max-width: 200px;">{{ message.created_at|date:"Y-m-d H:i:s" }}</td>
                  <td style="min-width: 200px; max-width: 200px;">{{ message.sender_node.node_name }}</td>
                  <td><p
                    style="min-width:800px; max-width: 800px; min-height: 100px; max-height: 100px; overflow: auto;">{{ message.message }}</p>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="3" class="text-center">
                    <div class="alert alert-warning p-4 mt-4 border border-warning border-2 rounded">
                      <i class="fa fa-exclamation-triangle me-2"></i>
                      <strong>No messages are available for this topic (yet).</strong>
                    </div>
                  </td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Pagination controls -->
          <div class="pagination-wrapper p-4">
            <nav aria-label="Logs pagination">
              <ul class="pagination">
                {% if page_obj.has_previous %}
                  <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                      <span aria-hidden="true">&laquo;</span>
                    </a>
                  </li>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                  <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                  </li>
                {% endfor %}

                {% if page_obj.has_next %}
                  <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                      <span aria-hidden="true">&raquo;</span>
                    </a>
                  </li>
                {% endif %}
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
