  <!--
  ~ Copyright (c) 2024 BMD™ Autonomous Holdings. All rights reserved.
  ~
  ~ Project: Jupi.tr™
  ~ File: list_browser_connections.html
  ~ Last Modified: 2024-10-01 23:45:03
  ~ Author: Ege Dogan Dursun (Co-Founder & Chief Executive Officer / CEO @ BMD™ Autonomous Holdings)
  ~ Created: 2024-10-05 01:36:44
  ~
  ~ This software is proprietary and confidential. Unauthorized copying,
  ~ distribution, modification, or use of this software, whether for
  ~ commercial, academic, or any other purpose, is strictly prohibited
  ~ without the prior express written permission of BMD™ Autonomous
  ~ Holdings.
  ~
  ~  For permission inquiries, please contact: admin@jupi.tr.
  ~
  -->

{% extends layout_path %}

{% load static %}
{% load i18n %}
{% load field_to_label %}

{% block title %}Browser Connections{% endblock %}

{% block vendor_css %}
  {{ block.super }}

<link rel="stylesheet" href="{% static 'vendor/libs/select2/select2.css' %}"/>
  <style>
    .text-wrap {
      white-space: normal;
      word-break: break-all;
    }
  </style>
{% endblock vendor_css %}

{% block vendor_js %}
  {{ block.super }}
  <script src="{% static 'vendor/libs/select2/select2.js' %}"></script>
{% endblock vendor_js %}

{% block content %}
  <div class="row g-6 mb-6">
    <div class="col-sm-6 col-xl-6">
      <h3 class="mb-0"><strong>Browser Connections</strong></h3>
    </div>
  </div>

  <div class="tips-section alert alert-secondary alert-dismissible d-flex col-lg-12 align-items-center" role="alert">
    <img src="{% static 'img/custom-illustrations-v2/i2-48.png' %}" width="25%" style="border-radius: 25px;"
         class="justify-content-end me-8" alt="Illustration for tip">
    <span class="alert-icon rounded">
    <i class="ti ti-bookmark"></i>
  </span>
    <div class="d-flex flex-column ps-1">
      <h5 class="alert-heading mb-2">Tip</h5>
      <p class="mb-0">
        In this page, you can manage your browser connections for your assistants. You must be aware of the fact
        that the browser connections are assistant-based. This means that the assistants will be able to use
        the browser connections that you have created here, and if you want another assistant to use the same browser
        connection, you need to create another connection for that assistant.
      </p>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div
        class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% else %}alert-danger{% endif %}"
        role="alert">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <!-- Browser Connections Cards -->
  {% for organization, assistants in connections_by_organization.items %}
    <div class="card mb-6">
      <div class="card-header border-bottom">
        <a class="collapsed" data-bs-toggle="collapse" href="#collapse-org-{{ organization.id }}" role="button"
           aria-expanded="false" aria-controls="collapse-org-{{ organization.id }}">
          <div class="d-flex">
            <img src="
              {% if organization.organization_image %}{{ organization.organization_image.url }}{% else %}{% static 'img/avatars/org-0.png' %}{% endif %}"
                 width="60" class="rounded me-4" alt="Organization image">
            <h4>
              <strong>{{ organization.name }}</strong>
            </h4>
          </div>
        </a>
        <i class="fa fa-arrow-alt-circle-down toggle-icon mt-8" data-target="#collapse-org-{{ organization.id }}"></i>
        <span data-bs-toggle="collapse" href="#collapse-org-{{ organization.id }}" role="button" aria-expanded="false"
              aria-controls="collapse-org-{{ organization.id }}">
      <strong class="mt-4">&nbsp; See Browser Connections of Assistants</strong>
    </span>
      </div>
      <div id="collapse-org-{{ organization.id }}" class="card-datatable table-responsive collapse">
        {% for assistant, connections in assistants.items %}
          <div class="assistant-group m-8">
            <div class="d-flex card card-border-shadow-primary p-4">
              <img src="
                {% if assistant.assistant_image %}{{ assistant.assistant_image.url }}{% else %}{% static 'img/avatars/org-0.png' %}{% endif %}"
                   width="80" class="rounded me-4" alt="Assistant image">
              <h5 class="assistant-title mt-4"><strong>{{ assistant.name }}</strong></h5>
            </div>
            <div class="card-datatable table-responsive mt-4">
              <a href="{% url 'datasource_browsers:create' %}">
                <button class="btn btn-success mb-8">
                  <i class="fa fa-add me-4"></i>
                  <strong> Add Browser Connection</strong>
                </button>
              </a>
            </div>
            <div class="row g-6 mb-4">
              {% for connection in connections %}
                <div class="col-xl-6 col-md-6">
                  <div class="card h-100">
                    <div class="card-header d-flex justify-content-between">
                      <div class="card-title mb-0">
                        <p class="card-subtitle mb-4"><strong>
                          <i class="fa fa-id-badge me-4"></i> Connection Name: &nbsp;&nbsp;</strong>
                          {{ connection.name }}
                        </p>
                        <p class="card-subtitle mb-0"><strong>
                          <i class="fa fa-desktop me-4"></i> Browser Type: &nbsp;&nbsp;</strong>
                          {{ connection.get_browser_type_display }}
                        </p>
                      </div>
                    </div>
                    <hr>
                    <div class="card-body">
                      <ul class="p-0 m-0">
                        <li class="mb-4 d-flex justify-content-between align-items-center">
                          <span class="text-body me-4">
                            <strong>
                              <i class="fa fa-info-circle me-2"></i>
                              Description:
                            </strong>
                          </span>
                          <span class="text-wrap">{{ connection.description|linebreaksbr }}</span>
                        </li>
                        <li class="mb-4 d-flex justify-content-between align-items-center">
                          <span class="text-body">
                            <strong>
                              <i class="fa fa-shield-alt me-2"></i>
                              Data Selectivity:
                            </strong>
                          </span>
                          <span class="text-wrap border border-warning rounded p-1">
                            <strong>
                              {% if connection.data_selectivity == 0.0 %}
                                None
                              {% elif connection.data_selectivity > 0.0 and connection.data_selectivity <= 0.2 %}
                                Very Low ( {{ connection.data_selectivity }} )
                              {% elif connection.data_selectivity > 0.2 and connection.data_selectivity <= 0.4 %}
                                Low ( {{ connection.data_selectivity }} )
                              {% elif connection.data_selectivity > 0.4 and connection.data_selectivity <= 0.6 %}
                                Medium ( {{ connection.data_selectivity }} )
                              {% elif connection.data_selectivity > 0.6 and connection.data_selectivity <= 0.8 %}
                                High ( {{ connection.data_selectivity }} )
                              {% elif connection.data_selectivity > 0.8 and connection.data_selectivity <= 1.0 %}
                                Very High ( {{ connection.data_selectivity }} )
                              {% endif %}
                            </strong>
                          </span>
                        </li>
                        <li class="mb-4 d-flex justify-content-between align-items-center">
                          <span class="text-body">
                            <strong>
                              <i class="fa fa-search me-2"></i>
                              Minimum Investigation:
                            </strong>
                          </span>
                          <span
                            class="text-wrap border border-warning p-1 rounded"><strong>{{ connection.minimum_investigation_sites }}</strong></span>
                        </li>
                        <li class="mb-4 d-flex justify-content-between align-items-center">
                          <span class="text-body">
                            <strong>
                              <i class="fa fa-theater-masks text-success me-2"></i>
                              Whitelisted Domain Extensions:
                            </strong>
                          </span>
                          <span class="text-wrap rounded">
                            <strong>
                              <ul class="p-0 m-0">
                                {% for extension in connection.whitelisted_extensions %}
                                  <li class="list-unstyled m-1 p-1 rounded bg-label-success">{{ extension }}</li>
                                {% empty %}
                                  <li class="list-unstyled m-2 p-2 rounded bg-label-dark">No Whitelisted Domains</li>
                                {% endfor %}
                              </ul>
                            </strong>
                           </span>
                        </li>
                        <li class="mb-4 d-flex justify-content-between align-items-center">
                          <span class="text-body">
                            <strong>
                              <i class="fa fa-theater-masks text-danger me-2"></i>
                              Blacklisted Domain Extensions:
                            </strong>
                          </span>
                          <span class="text-wrap rounded">
                            <strong>
                              <ul class="p-0 m-0">
                                {% for extension in connection.blacklisted_extensions %}
                                  <li class="list-unstyled m-1 p-1 rounded bg-label-danger">{{ extension }}</li>
                                {% empty %}
                                  <li class="list-unstyled m-2 p-2 rounded bg-label-dark">No Blacklisted Domains</li>
                                {% endfor %}
                              </ul>
                            </strong>
                          </span>
                        </li>
                        <hr>
                        <div class="text-body">
                          <strong>
                            <i class="fa fa-gears me-2 mb-2 mt-2"></i>
                            HTML Cleanup Strategies
                          </strong>
                        </div>
                        <hr>
                        <li class="mb-4 d-flex justify-content-between align-items-center">
                          <ul class="p-0 m-0">
                            <div class="row p-2">
                              {% for ability_name, value in connection.reading_abilities.items %}
                                <li
                                  class="list-unstyled col-5 mb-4 bg-label-dark p-1 m-1 rounded justify-content-center align-content-center align-items-center">
                                  <div class=""><strong>{{ ability_name|field_name_to_label }}:
                                    {% if value == True %}
                                      <strong class="bg-label-danger m-1 p-1 rounded">
                                        <i class="fa fa-remove"></i>
                                      </strong>
                                    {% else %}
                                      <strong class="bg-label-success m-1 p-1 rounded">
                                        <i class="fa fa-check"></i>
                                      </strong>
                                    {% endif %}
                                  </strong>
                                  </div>
                                </li>
                              {% endfor %}
                            </div>
                          </ul>
                        </li>
                      </ul>
                      <hr>
                      <div class="d-flex justify-content-center">
                        <a href="{% url 'datasource_browsers:logs' connection.id %}" class="btn btn-success me-6"><i
                          class="ti ti-report-analytics me-2"></i><strong>Browsing Logs</strong></a>
                        <a href="{% url 'datasource_browsers:update' connection.id %}" class="btn btn-primary me-6"><i
                          class="ti ti-edit me-2"></i><strong>Edit Connection</strong></a>
                        <a href="{% url 'datasource_browsers:delete' connection.id %}" class="btn btn-danger"><i
                          class="ti ti-trash"></i><strong> Delete </strong></a>
                      </div>
                    </div>
                  </div>
                </div>
              {% empty %}
                <div class="alert alert-warning p-8 m-4" role="alert">
                  <div class="">
                    <i class="fa fa-exclamation-triangle me-4"></i>
                    <strong>No Browser Connections have been created for this assistant yet.</strong>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
          <hr>
        {% endfor %}
      </div>
    </div>
  {% endfor %}

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll('.toggle-icon').forEach(function (icon) {
        icon.addEventListener('click', function () {
          var target = document.querySelector(this.getAttribute('data-target'));
          var bootstrapCollapse = new bootstrap.Collapse(target, {
            toggle: false
          });
          if (target.classList.contains('show')) {
            bootstrapCollapse.hide();
          } else {
            bootstrapCollapse.show();
          }
        });
      });

      document.querySelectorAll('.collapse').forEach(function (collapse) {
        collapse.addEventListener('show.bs.collapse', function () {
          var icon = document.querySelector(`.toggle-icon[data-target="#${this.id}"]`);
          if (icon) {
            icon.classList.remove('fa-arrow-alt-circle-down');
            icon.classList.add('fa-arrow-alt-circle-up');
          }
        });

        collapse.addEventListener('hide.bs.collapse', function () {
          var icon = document.querySelector(`.toggle-icon[data-target="#${this.id}"]`);
          if (icon) {
            icon.classList.remove('fa-arrow-alt-circle-up');
            icon.classList.add('fa-arrow-alt-circle-down');
          }
        });
      });
    });
  </script>

{% endblock %}
