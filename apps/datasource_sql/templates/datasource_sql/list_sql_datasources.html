{% extends layout_path %}

{% load static %}
{% load i18n %}
{% load field_to_label %}

{% block title %}SQL Database Connections{% endblock %}

{% block vendor_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'vendor/libs/flatpickr/flatpickr.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/select2/select2.css' %}" />
<style>
  .text-wrap {
      white-space: normal;
      word-break: break-all;
  }
</style>
{% endblock vendor_css %}

{% block vendor_js %}
{{ block.super }}
<script src="{% static 'vendor/libs/cleavejs/cleave.js' %}"></script>
<script src="{% static 'vendor/libs/cleavejs/cleave-phone.js' %}"></script>
<script src="{% static 'vendor/libs/moment/moment.js' %}"></script>
<script src="{% static 'vendor/libs/flatpickr/flatpickr.js' %}"></script>
<script src="{% static 'vendor/libs/select2/select2.js' %}"></script>
{% endblock vendor_js %}

{% block page_js %}
{{ block.super }}
<script src="{% static 'js/form-layouts.js' %}"></script>
{% endblock page_js %}

{% block content %}
<div class="row g-6 mb-6">
  <div class="col-sm-6 col-xl-6">
    <h3 class="mb-0"><strong>Your SQL Database Connections</strong></h3>
  </div>
</div>

<div class="alert alert-secondary alert-dismissible d-flex col-lg-10 align-items-center" role="alert">
  <img src="{% static 'img/custom-illustrations/boy-red-2.png' %}" width="25%" class="justify-content-end">
  <span class="alert-icon rounded">
    <i class="ti ti-bookmark"></i>
  </span>
  <div class="d-flex flex-column ps-1">
    <h5 class="alert-heading mb-2">Tip</h5>
    <p class="mb-0">
      In this page, you can manage your SQL database connections for your assistants. You must be aware of the fact
      that the SQL data source connections are assistant-based. This means that the assistants will be able to use
      the SQL data sources that you have created here, and if you want another assistant to use the same SQL data
      source, you need to create another connection for that assistant.
    </p>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
</div>

<!-- SQL Database Connections Cards -->
<div class="row g-6 mb-8">
  {% for connection in sql_connections %}
  <div class="col-xl-6 col-md-6">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between">
        <div class="card-title mb-0">
          <p class="mb-1 label bg-label-info rounded p-2 mb-4"><strong>{{ connection.assistant }}</strong></p>
          <h5 class="mb-4"><strong>{{ connection.name }}</strong></h5>
          <p class="card-subtitle mb-4"><strong>
            <i class="fa fa-database me-4"></i> System: &nbsp;&nbsp;</strong>
            {{ connection.dbms_type }}
          </p>
          <p class="card-subtitle"><strong>
            <i class="fa fa-id-badge me-4"></i> DB Name: &nbsp;&nbsp;</strong>
            {{ connection.database_name }}
          </p>
        </div>
      </div>
      <hr>
      <div class="card-body">
        <ul class="p-0 m-0 mb-8">
          <li class="mb-4 d-flex justify-content-between align-items-center">
            <span class="text-body"><strong>Host:</strong></span>
            <span class="text-wrap bg-label-warning p-2 rounded"><strong>{{ connection.host }}</strong></span>
          </li>
          <li class="mb-4 d-flex justify-content-between align-items-center">
            <span class="text-body"><strong>Port:</strong></span>
            <span class="text-wrap bg-label-warning p-2 rounded"><strong>{{ connection.port }}</strong></span>
          </li>
          <li class="mb-4 d-flex justify-content-between align-items-center">
            <span class="text-body"><strong>Username:</strong></span>
            <span class="text-wrap bg-label-warning p-2 rounded"><strong>{{ connection.username }}</strong></span>
          </li>
          <li class="mb-4 d-flex justify-content-between align-items-center">
            <span class="text-body me-4"><strong>Description:</strong></span>
            <span class="text-wrap">{{ connection.description|linebreaksbr }}</span>
          </li>
          <li class="mb-4 d-flex justify-content-between align-items-center">
            <span class="text-body"><strong>Read Only:</strong></span>
            <span class="text-wrap {% if connection.is_read_only %}bg-label-success{% else %}bg-label-danger{% endif %} rounded p-2"><strong>{{ connection.is_read_only|yesno:"Yes,No" }}</strong></span>
          </li>
        </ul>
        <hr class="pb-4">
        <div class="d-flex justify-content-center">
          <a href="{% url 'datasource_sql:update' connection.id %}" class="btn btn-primary me-3"><i class="ti ti-edit me-2"></i><strong>Edit Connection</strong></a>
          <a href="{% url 'datasource_sql:delete' connection.id %}" class="btn btn-danger"><i class="ti ti-trash"></i><strong> Delete </strong></a>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% endblock %}
