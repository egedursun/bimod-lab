<!--
  ~ Copyright (c) 2024 BMD™ Autonomous Holdings. All rights reserved.
  ~
  ~ Project: Bimod.io™
  ~ File: metakanban_board_logs.html
  ~ Last Modified: 2024-10-27 21:58:47
  ~ Author: Ege Dogan Dursun (Co-Founder & Chief Executive Officer / CEO @ BMD™ Autonomous Holdings)
  ~ Created: 2024-10-27 21:58:47
  ~
  ~ This software is proprietary and confidential. Unauthorized copying,
  ~ distribution, modification, or use of this software, whether for
  ~ commercial, academic, or any other purpose, is strictly prohibited
  ~ without the prior express written permission of BMD™ Autonomous
  ~ Holdings.
  ~
  ~  For permission inquiries, please contact: admin@Bimod.io.
  ~
  -->

{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}Board Change Logs{% endblock %}

{% block vendor_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'vendor/libs/datatables-bs5/datatables.bootstrap5.css' %}" />
  <link rel="stylesheet" href="{% static 'vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css' %}" />
  <link rel="stylesheet" href="{% static 'vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css' %}" />
{% endblock %}

{% block content %}
  <div class="container mt-4">
    <div class="card">
      <div class="card-header">
        <h3><strong>Change Logs</strong></h3>
      </div>

      <div class="card-body overflow-auto">

        <a href="{% url 'metakanban:board_detail' board.id %}">
          <button class="btn btn-secondary mt-4 mb-4">
            <i class="fa fa-chevron-left me-4"></i>
            <strong> Back to MetaKanban™ Board</strong>
          </button>
        </a>

        <hr>

        <!-- Tip Section -->
        <div class="tips-section alert alert-secondary alert-dismissible d-flex col-lg-12 align-items-center"
             role="alert">
          <img src="{% static 'img/custom-illustrations-v2/i2-52.png' %}" width="25%" style="border-radius:25px;"
               class="justify-content-end me-8" alt="Illustration for tip">
          <span class="alert-icon rounded">
            <i class="ti ti-bookmark"></i>
          </span>
          <div class="d-flex flex-column ps-1">
            <h5 class="alert-heading mb-2">Tip</h5>
            <p class="mb-0">
              This page displays all changes made on the board, including task updates, additions, and other relevant
              actions. This page is purely for tracking purposes and does not allow any actions to be taken.
            </p>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        </div>

        <!-- Display messages -->
        {% if messages %}
          {% for message in messages %}
            <div
              class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% else %}alert-info{% endif %}"
              role="alert">
              {{ message }}
            </div>
          {% endfor %}
        {% endif %}
        <hr>

        <!-- Logs Table -->
        <table class="table table-striped mt-4">
          <img src="{% static 'img/metakanban/kbn-6.png' %}" class="rounded mb-4 mt-4" style="width: 100%;"
               alt="Illustration for tips">
          <thead>
          <tr>
            <th>Timestamp</th>
            <th>Action Type</th>
            <th>Action Details</th>
            <th style="min-width: 150px;">Changed By</th>
          </tr>
          </thead>
          <tbody>
          {% for log in page_obj %}
            <tr>
              <td><strong>{{ log.timestamp|date:"Y-m-d H:i" }}</strong></td>
              <td><strong>
                <div class="btn-primary p-2 rounded">{{ log.get_action_type_display }}</div>
              </strong></td>
              <td><strong>{{ log.action_details }}</strong></td>
              <td><strong>{% if log.change_by_user %}
                <div class="btn-dark p-1 rounded ps-4">{{ log.change_by_user.username }}</div>{% else %}
                <div class="btn-success p-1 rounded"><i class="fa fa-robot ms-2 me-2"></i>AI Agent</div>{% endif %}
              </strong></td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="5">
                <div class="alert alert-warning mt-4 p-4 border border-warning border-2 rounded" role="alert">
                  <i class="fa fa-exclamation-triangle me-2"></i>
                  <strong>No logs found for this board (yet).</strong>
                </div>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>

        <hr>

        <!-- Pagination Controls -->
        <nav aria-label="Page navigation" class="mt-8">
          <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page=1" aria-label="First">
                  <span aria-hidden="true">&laquo;&laquo;</span>
                </a>
              </li>
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <span class="page-link">&laquo;&laquo;</span>
              </li>
              <li class="page-item disabled">
                <span class="page-link">&laquo;</span>
              </li>
            {% endif %}

            {% for i in page_obj.paginator.page_range %}
              <li class="page-item {% if page_obj.number == i %}active{% endif %}">
                <a class="page-link" href="?page={{ i }}">{{ i }}</a>
              </li>
            {% endfor %}

            {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" aria-label="Last">
                  <span aria-hidden="true">&raquo;&raquo;</span>
                </a>
              </li>
            {% else %}
              <li class="page-item disabled">
                <span class="page-link">&raquo;</span>
              </li>
              <li class="page-item disabled">
                <span class="page-link">&raquo;&raquo;</span>
              </li>
            {% endif %}
          </ul>
        </nav>
      </div>
    </div>
  </div>
{% endblock %}
