  <!--
  ~ Copyright (c) 2024 BMD™ Autonomous Holdings. All rights reserved.
  ~
  ~ Project: Bimod.io™
  ~ File: list_memories.html
  ~ Last Modified: 2024-10-05 01:39:48
  ~ Author: Ege Dogan Dursun (Co-Founder & Chief Executive Officer / CEO @ BMD™ Autonomous Holdings)
  ~ Created: 2024-10-05 14:42:34
  ~
  ~ This software is proprietary and confidential. Unauthorized copying,
  ~ distribution, modification, or use of this software, whether for
  ~ commercial, academic, or any other purpose, is strictly prohibited
  ~ without the prior express written permission of BMD™ Autonomous
  ~ Holdings.
  ~
  ~  For permission inquiries, please contact: admin@Bimod.io.
  ~
  -->

{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}List Assistant Memories{% endblock %}

{% block vendor_css %}
  {{ block.super }}
<link rel="stylesheet" href="{% static 'vendor/libs/datatables-bs5/datatables.bootstrap5.css' %}"/>
  <link rel="stylesheet" href="{% static 'vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css' %}"/>
  <link rel="stylesheet" href="{% static 'vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css' %}"/>
  <link rel="stylesheet" href="{% static 'vendor/libs/select2/select2.css' %}"/>
  <link rel="stylesheet" href="{% static 'vendor/libs/@form-validation/form-validation.css' %}"/>
  <link rel="stylesheet" href="{% static 'vendor/libs/sweetalert2/sweetalert2.css' %}"/>
{% endblock vendor_css %}

{% block vendor_js %}
  {{ block.super }}
  <script src="{% static 'vendor/libs/datatables-bs5/datatables-bootstrap5.js' %}"></script>
  <script src="{% static 'vendor/libs/select2/select2.js' %}"></script>
  <script src="{% static 'vendor/libs/@form-validation/popular.js' %}"></script>
  <script src="{% static 'vendor/libs/@form-validation/bootstrap5.js' %}"></script>
  <script src="{% static 'vendor/libs/@form-validation/auto-focus.js' %}"></script>
  <script src="{% static 'vendor/libs/cleavejs/cleave.js' %}"></script>
  <script src="{% static 'vendor/libs/cleavejs/cleave-phone.js' %}"></script>
  <script src="{% static 'vendor/libs/sweetalert2/sweetalert2.js' %}"></script>
{% endblock vendor_js %}

{% block page_js %}
  {{ block.super }}
  <script src="{% static 'js/app-assistants-list.js' %}"></script>
{% endblock page_js %}

{% block content %}
  <div class="row g-6 mb-6">
    <div class="col-sm-6 col-xl-4">
      <h3 class="mb-0">
        <strong>Assistant Memories</strong>
      </h3>
    </div>
  </div>

  <div class="tips-section alert alert-secondary alert-dismissible d-flex col-lg-12 align-items-center" role="alert">
    <img src="{% static 'img/custom-illustrations-v2/i2-9.png' %}" width="25%" style="border-radius: 25px;"
         class="justify-content-end me-8" alt="Illustration for tip">
    <span class="alert-icon rounded ms-4">
    <i class="ti ti-bookmark"></i>
  </span>
    <div class="d-flex flex-column ps-1">
      <h5 class="alert-heading mb-2">Tip</h5>
      <p class="mb-0">
        In this page, you can view all the memories of the assistants of the organizations you have created. You can
        also
        delete any memory that belongs to you as an administrator. To create a new memory, click on the "Create Memory"
        button, which is located in the tab on the left side of your screen. The user-specific memory is a memory that
        is
        specific to a user, in which the memory will only be accessible for the chats of that user. The
        assistant-specific
        memory is a memory that is specific to the assistant, in which the memory will be accessible for all the chats
        of
        the assistant, independent of the user.
      </p>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
      </button>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div
        class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% else %}alert-danger{% endif %}"
        role="alert">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <hr>

  {% for organization, memories in org_assistants.items %}
    <!-- Organization's Memories List Table -->
    <div class="card mb-6">
      <div class="card-header border-bottom">
        <a class="collapsed" data-bs-toggle="collapse" href="#collapse-{{ organization.id }}" role="button"
           aria-expanded="false" aria-controls="collapse-{{ organization.id }}">
          <div class="d-flex">
            <img class="rounded me-4" src="


              {% if organization.organization_image %}{{ organization.organization_image.url }}{% else %}{% static 'img/avatars/org-0.png' %}{% endif %}"
                 alt="Organization Image" width="50">
            <h4>
              <strong>{{ organization.name }}</strong>
            </h4>
          </div>
        </a>
        <p class="mt-4">
          <i class="fa fa-robot"></i>
          <strong>&nbsp; Number of Memories: </strong> {{ memories|length }}
        </p>
        <i class="fa fa-arrow-alt-circle-down toggle-icon" data-target="#collapse-{{ organization.id }}"></i>
        <span data-bs-toggle="collapse" href="#collapse-{{ organization.id }}" role="button" aria-expanded="false"
              aria-controls="collapse-{{ organization.id }}">
      <strong>&nbsp; See Memories of Organization</strong>
    </span>
      </div>
      <div id="collapse-{{ organization.id }}" class="card-datatable table-responsive collapse">
        <div class="card-datatable table-responsive">
          <a href="{% url 'memories:create' %}">
            <button class="btn btn-success mt-4 ms-4">
              <i class="fa fa-add me-4"></i>
              <strong> Add Memory Item</strong>
            </button>
          </a>
        </div>
        <table class="datatables-memories table">
          <thead class="border-top">
          <tr>
            <th></th>
            <th>Assistant</th>
            <th>Creator</th>
            <th>Memory Type</th>
            <th>Memory Content</th>
            <th>Created At</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody>
          {% for memory in memories %}
            <tr>
              <td>
                <img class="rounded" src="{% if memory.assistant.assistant_image %}{{ memory.assistant.assistant_image.url }}{% else %}{% static 'img/avatars/org-0.png' %}{% endif %}"
                     alt="Assistant Image" width="50">
              </td>
              <td><strong>{{ memory.assistant.name }}</strong></td>
              <td><strong>{{ memory.user.username }}</strong></td>
              <td>
                {% if memory.get_memory_type_display == "Organization-Specific" %}
                  <span
                    class="card p-2 card-border-shadow btn-success"><strong>{{ memory.get_memory_type_display }}</strong>
                  </span>
                {% elif memory.get_memory_type_display == "User-Specific" %}
                  <span
                    class="card p-2 card-border-shadow btn-warning"><strong>{{ memory.get_memory_type_display }}</strong>
                  </span>
                {% else %}
                  <span
                    class="card p-2 card-border-shadow btn-info"><strong>{{ memory.get_memory_type_display }}</strong>
                  </span>
                {% endif %}
              </td>
              <td>{{ memory.memory_text_content }}</td>
              <td>{{ memory.created_at }}</td>
              <td>
                <a href="{% url 'memories:delete' memory.id %}" class="btn btn-sm btn-danger"><strong>
                  <i class="fa fa-trash me-2"></i>
                  Delete
                </strong></a>
              </td>
            </tr>
          {% empty %}
            <div class="alert alert-warning ms-4 me-4" role="alert">
              <i class="fa fa-exclamation-triangle me-4"></i>
              <strong>No memories found for this organization.</strong>
            </div>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endfor %}

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll('.toggle-icon').forEach(function (icon) {
        icon.addEventListener('click', function () {
          var target = document.querySelector(this.getAttribute('data-target'));
          var bootstrapCollapse = new bootstrap.Collapse(target, {
            toggle: false
          });
          if (target.classList.contains('show')) {
            bootstrapCollapse.hide();
          } else {
            bootstrapCollapse.show();
          }
        });
      });

      document.querySelectorAll('.collapse').forEach(function (collapse) {
        collapse.addEventListener('show.bs.collapse', function () {
          var icon = document.querySelector(`.toggle-icon[data-target="#${this.id}"]`);
          if (icon) {
            icon.classList.remove('fa-arrow-alt-circle-down');
            icon.classList.add('fa-arrow-alt-circle-up');
          }
        });

        collapse.addEventListener('hide.bs.collapse', function () {
          var icon = document.querySelector(`.toggle-icon[data-target="#${this.id}"]`);
          if (icon) {
            icon.classList.remove('fa-arrow-alt-circle-up');
            icon.classList.add('fa-arrow-alt-circle-down');
          }
        });
      });

      document.querySelectorAll('.btn-danger').forEach(function (button) {
        button.addEventListener('click', function (event) {
          event.preventDefault();
          const form = button.closest('a').getAttribute('href');

          Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this action.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, delete it!',
            customClass: {
              confirmButton: 'btn btn-danger me-2 waves-effect waves-light',
              cancelButton: 'btn btn-label-secondary waves-effect waves-light'
            },
            buttonsStyling: false
          }).then((result) => {
            if (result.isConfirmed) {
              window.location.href = form;
            }
          });
        });
      });
    });
  </script>

{% endblock %}
