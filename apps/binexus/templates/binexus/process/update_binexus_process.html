<!--
  ~ Copyright (c) 2024 BMD™ Autonomous Holdings. All rights reserved.
  ~
  ~ Project: Bimod.io™
  ~ File: update_binexus_process.html
  ~ Last Modified: 2024-10-22 18:40:25
  ~ Author: Ege Dogan Dursun (Co-Founder & Chief Executive Officer / CEO @ BMD™ Autonomous Holdings)
  ~ Created: 2024-10-22 18:40:25
  ~
  ~ This software is proprietary and confidential. Unauthorized copying,
  ~ distribution, modification, or use of this software, whether for
  ~ commercial, academic, or any other purpose, is strictly prohibited
  ~ without the prior express written permission of BMD™ Autonomous
  ~ Holdings.
  ~
  ~  For permission inquiries, please contact: admin@Bimod.io.
  ~
  -->

{% extends layout_path %}
{% load static %}
{% load i18n %}

{% block title %}Update Binexus Process{% endblock %}

{% block vendor_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'vendor/libs/select2/select2.css' %}" />
{% endblock vendor_css %}

{% block vendor_js %}
  {{ block.super }}
  <script src="{% static 'vendor/libs/select2/select2.js' %}"></script>
  <script>
    $(document).ready(function() {
      $('#llm_model, #organization').select2({
        placeholder: 'Select an option',
        allowClear: true,
        width: '100%'
      });
      $('#submit_button').prop('disabled', true);
      $('form').on('change input', function() {
        let isFormValid = $('#organization').val() && $('#process_name').val();
        $('#submit_button').prop('disabled', !isFormValid);
      });
      $('#awarenessCheckbox').on('change', function() {
        let isChecked = $(this).is(':checked');
        $('#timeAwareness').val(isChecked ? 'on' : 'off');
        $('#placeAwareness').val(isChecked ? 'on' : 'off');
      });
    });
  </script>
  <script>
    function addKeyValuePair() {
      const container = document.getElementById('key-value-container');
      const keyValuePair = document.createElement('div');
      keyValuePair.classList.add('key-value-pair', 'row', 'mb-4');

      keyValuePair.innerHTML = `
          <div class="col-5">
              <input type="text" class="form-control" name="additional_genes_keys[]" placeholder="Gene Name">
          </div>
          <div class="col-5">
              <input type="text" class="form-control gene-value-input" name="additional_genes_values[]" placeholder="Gene Value Set (Comma Separated ',')" oninput="splitValuesToBadges(this)">
              <div class="gene-value-badges mt-2 fw-bolder"></div>
          </div>
          <div class="col-2">
              <button class="btn btn-danger w-100" type="button" onclick="removeKeyValuePair(this)">
                  <i class="fa fa-minus me-2"></i><strong>Remove</strong>
              </button>
          </div>
      `;
      container.appendChild(keyValuePair);
    }

    function removeKeyValuePair(element) {
      element.closest('.key-value-pair').remove();
    }

    function splitValuesToBadges(input) {
      const values = input.value.split(',');
      const badgesContainer = input.nextElementSibling;
      badgesContainer.innerHTML = '';
      values.forEach(value => {
        const trimmedValue = value.trim();
        if (trimmedValue) {
          const badge = document.createElement('span');
          badge.classList.add('badge', 'btn-primary', 'm-1', 'p-2');
          badge.textContent = trimmedValue;
          badgesContainer.appendChild(badge);
        }
      });
    }
  </script>
{% endblock vendor_js %}

{% block content %}
  <div class="tips-section alert alert-secondary alert-dismissible d-flex col-lg-12 align-items-center" role="alert">
    <img src="{% static 'img/custom-illustrations-v2/i2-63.png' %}" width="25%" style="border-radius:25px;"
         class="justify-content-end me-8" alt="Illustration for tip">
    <span class="alert-icon rounded">
      <i class="ti ti-bookmark"></i>
    </span>
    <div class="d-flex flex-column ps-1">
      <h5 class="alert-heading mb-2">Tip</h5>
      <p class="mb-0">
        In this page, you can update the details of the Binexus process. Once you update a process, you can manage
        it from the process list page, where you can run, delete, or view its details.
      </p>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
      </button>
    </div>
  </div>

  <hr>

  {% if messages %}
    {% for message in messages %}
      <div class="alert {% if message.tags == 'success' %}alert-success{% else %}alert-danger{% endif %}" role="alert">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <hr>

  <div class="row mt-4">
    <div class="col-xl mb-6">
      <div class="card">
        <div class="card-header justify-content-between align-items-center">
          <h5 class="mb-0"><strong>Update Binexus Process</strong></h5>
          <a href="{% url 'binexus:process_list' %}">
            <button class="btn btn-secondary mt-4 mb-8">
              <i class="fa fa-list me-4"></i>
              <strong> Manage Processes</strong>
            </button>
          </a>
        </div>
        <hr>
        <div class="card-body mt-4">
          <form method="post" action="{% url 'binexus:process_update' pk=binexus_process.id %}">
            {% csrf_token %}
            <div class="row p-8">

              <div class="col-4 mb-6">
                <label class="form-label" for="organization">Organization</label>
                <select class="form-select" id="organization" name="organization" required>
                  {% for org in organizations %}
                    <option value="{{ org.id }}" {% if org.id == binexus_process.organization.id %}selected{% endif %}>
                      {{ org.name }}
                    </option>
                  {% endfor %}
                </select>
              </div>

              <div class="col-4 mb-6">
                <label class="form-label" for="llm_model">LLM Model</label>
                <select class="form-select" id="llm_model" name="llm_model" required>
                  {% for model in llm_models %}
                    <option value="{{ model.id }}" {% if model.id == binexus_process.llm_model.id %}selected{% endif %}>
                      {{ model.nickname }}
                    </option>
                  {% endfor %}
                </select>
              </div>

              <div class="col-4 mb-6">
                <label class="form-label" for="process_name">Process Name</label>
                <input type="text" class="form-control" id="process_name" name="process_name"
                       placeholder="Enter process name" value="{{ binexus_process.process_name }}" required>
              </div>

              <div class="col-4 mb-6">
                <label class="form-label" for="process_description">Process Description</label>
                <textarea class="form-control" id="process_description" name="process_description" rows="2"
                          placeholder="Enter a description for this process.">{{ binexus_process.process_description }}</textarea>
              </div>

              <div class="col-4 mb-6">
                <label class="form-label" for="process_objective">Process Objective</label>
                <textarea class="form-control" id="process_objective" name="process_objective" rows="2"
                          placeholder="Enter process objective.">{{ binexus_process.process_objective }}</textarea>
              </div>

              <div class="col-4 mb-6">
                <label class="form-label" for="process_success_criteria">Process Success Criteria</label>
                <textarea class="form-control" id="process_success_criteria" name="process_success_criteria" rows="2"
                          placeholder="Enter success criteria for this process.">{{ binexus_process.process_success_criteria }}</textarea>
              </div>

              <div class="col-4 mb-6">
                <img src="{% static 'img/binexus/bx-1.jpg' %}" width="100%" style="border-radius:50px;"
                     class="justify-content-end me-8 p-8 image" alt="Hadron prime image">
                <label class="form-label" for="fitness_manager_selectiveness">Fitness Manager Selectiveness</label>
                <input type="number" class="form-control" id="fitness_manager_selectiveness"
                       name="fitness_manager_selectiveness" min="0.0" max="1.0" step="0.1"
                       value="{{ binexus_process.fitness_manager_selectiveness }}">
              </div>

              <div class="col-4 mb-6">
                <img src="{% static 'img/binexus/bx-2.jpg' %}" width="100%" style="border-radius:50px;"
                     class="justify-content-end me-8 p-8 image" alt="Hadron prime image">
                <label class="form-label" for="optimization_generations">Optimization Generations</label>
                <input type="number" class="form-control" id="optimization_generations" name="optimization_generations"
                       min="1" max="25" value="{{ binexus_process.optimization_generations }}" required>
              </div>

              <div class="col-4 mb-6">
                <img src="{% static 'img/binexus/bx-3.jpg' %}" width="100%" style="border-radius:50px;"
                     class="justify-content-end me-8 p-8 image" alt="Hadron prime image">
                <label class="form-label" for="optimization_population_size">Optimization Population Size</label>
                <input type="number" class="form-control" id="optimization_population_size"
                       name="optimization_population_size" min="1" max="25"
                       value="{{ binexus_process.optimization_population_size }}" required>
              </div>

              <div class="col-3 mb-6">
                <img src="{% static 'img/binexus/bx-4.jpg' %}" width="100%" style="border-radius:50px;"
                     class="justify-content-end me-8 p-8 image" alt="Hadron prime image">
                <label class="form-label" for="optimization_breeding_pool_rate">Optimization Breeding Pool Rate</label>
                <input type="number" class="form-control" id="optimization_breeding_pool_rate"
                       name="optimization_breeding_pool_rate" min="0" max="1" step="0.05"
                       value="{{ binexus_process.optimization_breeding_pool_rate }}" required>
              </div>

              <div class="col-3 mb-6">
                <img src="{% static 'img/binexus/bx-5.jpg' %}" width="100%" style="border-radius:50px;"
                     class="justify-content-end me-8 p-8 image" alt="Hadron prime image">
                <label class="form-label" for="optimization_mutation_rate_per_individual">Mutation Rate per
                  Individual</label>
                <input type="number" class="form-control" id="optimization_mutation_rate_per_individual"
                       name="optimization_mutation_rate_per_individual" min="0" max="1" step="0.01"
                       value="{{ binexus_process.optimization_mutation_rate_per_individual }}" required>
              </div>

              <div class="col-3 mb-6">
                <img src="{% static 'img/binexus/bx-6.jpg' %}" width="100%" style="border-radius:50px;"
                     class="justify-content-end me-8 p-8 image" alt="Hadron prime image">
                <label class="form-label" for="optimization_mutation_rate_per_gene">Mutation Rate per Gene</label>
                <input type="number" class="form-control" id="optimization_mutation_rate_per_gene"
                       name="optimization_mutation_rate_per_gene" min="0" max="1" step="0.01"
                       value="{{ binexus_process.optimization_mutation_rate_per_gene }}" required>
              </div>

              <div class="col-3 mb-6">
                <img src="{% static 'img/binexus/bx-7.jpg' %}" width="100%" style="border-radius:50px;"
                     class="justify-content-end me-8 p-8 image" alt="Hadron prime image">
                <label class="form-label" for="optimization_crossover_rate">Crossover Rate</label>
                <input type="number" class="form-control" id="optimization_crossover_rate"
                       name="optimization_crossover_rate" min="0" max="1" step="0.01"
                       value="{{ binexus_process.optimization_crossover_rate }}" required>
              </div>

              <div class="col-12 mb-6 mt-4">
                <h5><strong>Additional Genes (Optional)</strong></h5>
                <div id="key-value-container">
                  {% if binexus_process.additional_genes %}
                    {% for gene_name, gene_values in binexus_process.additional_genes.items %}
                      <div class="key-value-pair row mb-4">
                        {% if forloop.first %}
                          <div class="col-5">
                            <label class="form-label" for="additional_genes_keys" hidden>Gene Name</label>
                            <input id="additional_genes_keys" type="text" class="form-control"
                                   name="additional_genes_keys[]" value="{{ gene_name }}" />
                          </div>
                          <div class="col-5">
                            <label class="form-label" for="additional_genes_values" hidden>Gene Value Set</label>
                            <input id="additional_genes_values" type="text" class="form-control gene-value-input"
                                   name="additional_genes_values[]" value="{{ gene_values|join:',' }}"
                                   oninput="splitValuesToBadges(this)">
                            <div class="gene-value-badges mt-2 fw-bolder">
                              {% for value in gene_values %}
                                <span class="badge btn-primary m-1 p-2">{{ value }}</span>
                              {% endfor %}
                            </div>
                          </div>
                          <div class="col-2">
                            <button class="btn btn-success w-100 mb-2" type="button" onclick="addKeyValuePair()">
                              <i class="fa fa-plus me-2"></i><strong>Add Row</strong>
                            </button>
                          </div>
                        {% else %}
                          <div class="col-5">
                            <label class="form-label" for="additional_genes_keys" hidden>Gene Name</label>
                            <input id="additional_genes_keys" type="text" class="form-control"
                                   name="additional_genes_keys[]" value="{{ gene_name }}" />
                          </div>
                          <div class="col-5">
                            <label class="form-label" for="additional_genes_values" hidden>Gene Value Set</label>
                            <input id="additional_genes_values" type="text" class="form-control gene-value-input"
                                   name="additional_genes_values[]" value="{{ gene_values|join:',' }}"
                                   oninput="splitValuesToBadges(this)">
                            <div class="gene-value-badges mt-2 fw-bolder">
                              {% for value in gene_values %}
                                <span class="badge btn-primary m-1 p-2">{{ value }}</span>
                              {% endfor %}
                            </div>
                          </div>
                          <div class="col-2">
                            <button class="btn btn-danger w-100" type="button" onclick="removeKeyValuePair(this)">
                              <i class="fa fa-minus me-2"></i><strong>Remove</strong>
                            </button>
                          </div>
                        {% endif %}
                      </div>
                    {% endfor %}
                  {% else %}
                    <!-- If no genes, display empty row with badges container -->
                    <div class="key-value-pair row mb-4">
                      <div class="col-5">
                        <label class="form-label" for="additional_genes_keys" hidden>Gene Name</label>
                        <input id="additional_genes_keys" type="text" class="form-control"
                               name="additional_genes_keys[]" placeholder="Gene Name" />
                      </div>
                      <div class="col-5">
                        <label class="form-label" for="additional_genes_values" hidden>Gene Value Set</label>
                        <input id="additional_genes_values" type="text" class="form-control gene-value-input"
                               name="additional_genes_values[]" placeholder="Gene Value Set (Comma Separated ',')"
                               oninput="splitValuesToBadges(this)">
                        <div class="gene-value-badges mt-2 fw-bolder"></div>
                      </div>
                      <div class="col-2">
                        <button class="btn btn-success w-100 mb-2" type="button" onclick="addKeyValuePair()">
                          <i class="fa fa-plus me-2"></i><strong>Add Row</strong>
                        </button>
                        <button class="btn btn-danger w-100" type="button" onclick="removeKeyValuePair(this)">
                          <i class="fa fa-minus me-2"></i><strong>Remove</strong>
                        </button>
                      </div>
                    </div>
                  {% endif %}
                </div>
              </div>

              <hr>

              <!-- Self Breeding Switch -->
              <div class="col-12 mb-6 mt-8">
                <label class="form-label" for="self_breeding_possible">Allow Self Breeding</label>
                <br>
                <label class="switch switch-square switch-lg mt-2">
                  <input type="checkbox" class="switch-input" id="self_breeding_possible" name="self_breeding_possible"
                         {% if binexus_process.self_breeding_possible or not binexus_process %}checked{% endif %}>
                  <span class="switch-toggle-slider">
                    <span class="switch-on"><i class="ti ti-check"></i></span>
                    <span class="switch-off"><i class="ti ti-x"></i></span>
                  </span>
                </label>
              </div>
            </div>
            <hr>

            <button type="submit" class="btn btn-primary d-flex w-25 mt-4" id="submit_button">
              <i class="fa fa-save me-4"></i>
              <strong>Update Binexus Process</strong>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
