<!--
  ~ Copyright (c) 2024 BMD™ Autonomous Holdings. All rights reserved.
  ~
  ~ Project: Bimod.io™
  ~ File: list_leanmod_scheduled_jobs.html
  ~ Last Modified: 2024-12-07 15:01:36
  ~ Author: Ege Dogan Dursun (Co-Founder & Chief Executive Officer / CEO @ BMD™ Autonomous Holdings)
  ~ Created: 2024-12-07 15:01:41
  ~
  ~ This software is proprietary and confidential. Unauthorized copying,
  ~ distribution, modification, or use of this software, whether for
  ~ commercial, academic, or any other purpose, is strictly prohibited
  ~ without the prior express written permission of BMD™ Autonomous
  ~ Holdings.
  ~
  ~  For permission inquiries, please contact: admin@Bimod.io.
  ~
  -->

{% extends layout_path %}

{% load static %}
{% load i18n %}

{% block title %}LeanMod Assistant Scheduled Jobs{% endblock %}

{% block vendor_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'vendor/libs/datatables-bs5/datatables.bootstrap5.css' %}" />
  <link rel="stylesheet" href="{% static 'vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css' %}" />
  <link rel="stylesheet" href="{% static 'vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css' %}" />
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.7.2/font/bootstrap-icons.min.css">
{% endblock vendor_css %}

{% block vendor_js %}
  {{ block.super }}
  <script src="{% static 'vendor/libs/datatables-bs5/datatables-bootstrap5.js' %}"></script>
{% endblock vendor_js %}

{% block page_js %}
  {{ block.super }}
  <script src="{% static 'js/scheduled-jobs-list.js' %}"></script>
{% endblock page_js %}

{% block content %}
  <div class="row g-6 mb-6">
    <div class="col-sm-12 col-xl-12">
      <h3 class="mb-0">
        <strong>LeanMod Assistant Scheduled Jobs</strong>
      </h3>
    </div>
  </div>

  <div class="tips-section alert alert-secondary alert-dismissible d-flex col-lg-12 align-items-center" role="alert">
    <img src="{% static 'img/custom-illustrations-v2/i2-24.png' %}" width="25%" style="border-radius: 25px;"
         class="justify-content-end me-8" alt="Illustration for tip">
    <span class="alert-icon rounded ms-4">
    <i class="bi bi-info-circle"></i>
  </span>
    <div class="d-flex flex-column ps-1">
      <h5 class="alert-heading mb-2">Tip</h5>
      <p class="mb-0">
        Use the search box to find specific jobs by name or description. You can delete the jobs if you no longer need
        them. The LeanMod scheduled jobs are used to automate the tasks that you want to run at specific times and
        intervals.
        The assistants can be assigned to the jobs to run the tasks for you. The jobs can be scheduled to run at
        specific times and intervals, and you can view the execution logs to understand the flow and status of the
        executions.
      </p>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">
      </button>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div
        class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% else %}alert-danger{% endif %}"
        role="alert">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <hr>

  <!-- Search and Filter Form -->
  <div class="row g-4 mb-4 mt-8 card card-border-shadow-primary p-4">
    <div class="col-xl-12">
      <h5 class="text-muted"><strong>Filter Jobs</strong></h5>
      <div class="card text-center mb-4">
        <div class="card-header">
          <div class="nav-align-top">
            <form method="get" action=".">
              <div class="input-group mb-3">
                <input type="text" name="search" value="{{ request.GET.search }}" class="form-control"
                       placeholder="Search by name or description">
                <button type="submit" class="btn btn-primary"><strong>Search</strong></button>
                <a href="." class="btn btn-secondary"><strong>Clear</strong></a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- LeanMod Scheduled Jobs List Table -->
  <div class="card">
    <div class="card-header">
      <h5 class="card-title">
        <strong>LeanMod Assistant Scheduled Jobs</strong>
      </h5>
      <img src="{% static 'img/scheduled_jobs/sch-3.png' %}" class="rounded mt-4 mb-4" style="width: 100%;"
           alt="Illustration for tips">
    </div>
    <div class="card-datatable table-responsive">
      <a href="{% url 'mm_scheduled_jobs:leanmod_create' %}">
        <button class="btn btn-success ms-4 mb-8">
          <i class="fa fa-plus me-4"></i>
          <strong>Create New Job</strong>
        </button>
      </a>
      <table class="table datatables-scheduled-jobs">
        <thead class="border-top">
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Created By</th>
          <th>LeanMod</th>
          <th>Schedule</th>
          <th>Current Run Count</th>
          <th>Maximum Runs</th>
          <th></th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for job in page_obj %}
          <tr>
            <td style="min-width: 200px; max-width: 200px;"><strong>{{ job.name }}</strong></td>
            <td style="min-width: 300px; max-width: 200px;">{{ job.task_description }}</td>
            <td style="min-width: 150px; max-width: 150px;"><strong>{{ job.created_by_user }}</strong></td>
            <td style="min-width: 250px; max-width: 250px;">
              <div class="btn-info rounded p-1"><strong>{{ job.leanmod.name }}</strong></div>
            </td>
            <td style="min-width: 380px; max-width: 380px;">
              <p class="bg-body rounded p-2 m-2 border border-primary-subtle border-3 rounded">
                <i class="bi bi-calendar-month me-4"></i>
                On months of the year: {% if job.month_of_year != "*" %}
                <strong>{{ job.month_of_year }}</strong>{% else %}<strong>Every Month</strong>{% endif %}
              </p>
              <p class="bg-body rounded p-2 m-2 border border-primary-subtle border-3 rounded">
                <i class="bi bi-calendar-day me-4"></i>
                On days of the month: {% if job.day_of_month != "*" %}
                <strong>{{ job.day_of_month }}</strong>{% else %}<strong>Every Month Day</strong>{% endif %}
              </p>
              <p class="bg-body rounded p-2 m-2 border border-primary-subtle border-3 rounded">
                <i class="bi bi-calendar-week me-4"></i>
                On days of the week: {% if job.day_of_week != "*" %}
                <strong>{{ job.day_of_week }}</strong>{% else %}<strong>Every Week Day</strong>{% endif %}
              </p>
              <p class="bg-body rounded p-2 m-2 border border-primary-subtle border-3 rounded">
                <i class="bi bi-clock me-4"></i>
                At hours of the day: {% if job.hour != "*" %}
                <strong>{{ job.hour }}</strong>{% else %}<strong>Every Hour</strong>{% endif %}
              </p>
              <p class="bg-body rounded p-2 m-2 border border-primary-subtle border-3 rounded">
                <i class="bi bi-hourglass-split me-4"></i>
                At minutes of the hour: {% if job.minute != "*" %}
                <strong>{{ job.minute }}</strong>{% else %}<strong>Every Minute</strong>{% endif %}
              </p>
            </td>
            <td style="min-width: 200px; max-width: 200px;">
              <strong class="border btn-success p-8 rounded">
                <i class="fa fa-hashtag me-2"></i>
                {{ job.current_run_count }}
              </strong>
            </td>
            <td style="min-width: 200px; max-width: 200px;">
              <strong class="border btn-warning p-8 rounded">
                <i class="fa fa-cogs me-2"></i>
                {{ job.maximum_runs }}
              </strong>
            </td>
            <td>
              <a href="{% url 'mm_scheduled_jobs:leanmod_logs' job.pk %}" class="btn btn-info"><i
                class="fa fa-clock-rotate-left me-2"></i><strong>Execution Logs</strong></a>
            </td>
            <td>
              <a href="{% url 'mm_scheduled_jobs:leanmod_delete' job.pk %}" class="btn btn-danger"><i
                class="fa fa-trash me-2"></i><strong>Delete</strong></a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="9">
              <div class="alert alert-warning mt-4 p-8 border border-warning border-2 rounded" role="alert">
                <i class="fa fa-exclamation-triangle me-2"></i><strong>
                No scheduled jobs for any of your organizations &amp; LeanMod assistants yet.
              </strong>
              </div>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      <!-- Pagination Controls -->
      <nav aria-label="Page navigation">
        <ul class="pagination pagination-rounded m-4 pb-4">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}"><i
                class="bi bi-chevron-double-left"></i></a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page=
                {{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"><i
                class="bi bi-chevron-left"></i></a>
            </li>
          {% endif %}
          {% for page_num in page_obj.paginator.page_range %}
            <li class="page-item {% if page_obj.number == page_num %}active{% endif %}">
              <a class="page-link" href="?page=
                {{ page_num }}{% if search_query %}&search={{ search_query }}{% endif %}">{{ page_num }}</a>
            </li>
          {% endfor %}
          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link"
                 href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"><i
                class="bi bi-chevron-right"></i></a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page=
                {{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}"><i
                class="bi bi-chevron-double-right"></i></a>
            </li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </div>
{% endblock %}



