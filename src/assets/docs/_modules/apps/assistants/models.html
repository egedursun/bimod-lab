<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>apps.assistants.models &#8212; Bimod.io v0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=fa47ad08"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for apps.assistants.models</h1><div class="highlight"><pre>
<span></span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">apps.assistants.utils</span> <span class="kn">import</span> <span class="n">generate_random_string</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">config.settings</span> <span class="kn">import</span> <span class="n">MEDIA_URL</span>

<span class="n">ASSISTANT_RESPONSE_LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># User&#39;s question language</span>
    <span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;Auto (Detect)&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="s2">&quot;English&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;es&quot;</span><span class="p">,</span> <span class="s2">&quot;Spanish&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;fr&quot;</span><span class="p">,</span> <span class="s2">&quot;French&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;de&quot;</span><span class="p">,</span> <span class="s2">&quot;German&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;it&quot;</span><span class="p">,</span> <span class="s2">&quot;Italian&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="s2">&quot;Portuguese&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;nl&quot;</span><span class="p">,</span> <span class="s2">&quot;Dutch&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ru&quot;</span><span class="p">,</span> <span class="s2">&quot;Russian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ja&quot;</span><span class="p">,</span> <span class="s2">&quot;Japanese&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="s2">&quot;Korean&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;zh&quot;</span><span class="p">,</span> <span class="s2">&quot;Chinese&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ar&quot;</span><span class="p">,</span> <span class="s2">&quot;Arabic&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;tr&quot;</span><span class="p">,</span> <span class="s2">&quot;Turkish&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;pl&quot;</span><span class="p">,</span> <span class="s2">&quot;Polish&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;sv&quot;</span><span class="p">,</span> <span class="s2">&quot;Swedish&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;da&quot;</span><span class="p">,</span> <span class="s2">&quot;Danish&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;fi&quot;</span><span class="p">,</span> <span class="s2">&quot;Finnish&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s2">&quot;Norwegian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;he&quot;</span><span class="p">,</span> <span class="s2">&quot;Hebrew&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;Indonesian&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="s2">&quot;Malay&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;th&quot;</span><span class="p">,</span> <span class="s2">&quot;Thai&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;hi&quot;</span><span class="p">,</span> <span class="s2">&quot;Hindi&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;hu&quot;</span><span class="p">,</span> <span class="s2">&quot;Hungarian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;cs&quot;</span><span class="p">,</span> <span class="s2">&quot;Czech&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;sk&quot;</span><span class="p">,</span> <span class="s2">&quot;Slovak&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;uk&quot;</span><span class="p">,</span> <span class="s2">&quot;Ukrainian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="s2">&quot;Romanian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;bg&quot;</span><span class="p">,</span> <span class="s2">&quot;Bulgarian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;el&quot;</span><span class="p">,</span> <span class="s2">&quot;Greek&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;fi&quot;</span><span class="p">,</span> <span class="s2">&quot;Finnish&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;et&quot;</span><span class="p">,</span> <span class="s2">&quot;Estonian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;lv&quot;</span><span class="p">,</span> <span class="s2">&quot;Latvian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;lt&quot;</span><span class="p">,</span> <span class="s2">&quot;Lithuanian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;Croatian&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;sr&quot;</span><span class="p">,</span> <span class="s2">&quot;Serbian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;sl&quot;</span><span class="p">,</span> <span class="s2">&quot;Slovenian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;mk&quot;</span><span class="p">,</span> <span class="s2">&quot;Macedonian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;sq&quot;</span><span class="p">,</span> <span class="s2">&quot;Albanian&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;bs&quot;</span><span class="p">,</span> <span class="s2">&quot;Bosnian&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;Icelandic&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span> <span class="s2">&quot;Welsh&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ga&quot;</span><span class="p">,</span> <span class="s2">&quot;Irish&quot;</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">ASSISTANT_RESPONSE_LANGUAGES</span> <span class="o">=</span> <span class="p">[</span><span class="n">ASSISTANT_RESPONSE_LANGUAGES</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ASSISTANT_RESPONSE_LANGUAGES</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<span class="n">CONTEXT_OVERFLOW_STRATEGY</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="s2">&quot;Stop Conversation&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;forget&quot;</span><span class="p">,</span> <span class="s2">&quot;Forget Oldest Messages&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;vectorize&quot;</span><span class="p">,</span> <span class="s2">&quot;Vectorize Oldest Messages&quot;</span><span class="p">),</span>
<span class="p">]</span>


<span class="k">class</span> <span class="nc">ContextOverflowStrategyNames</span><span class="p">:</span>
    <span class="n">STOP</span> <span class="o">=</span> <span class="s2">&quot;stop&quot;</span>
    <span class="n">FORGET</span> <span class="o">=</span> <span class="s2">&quot;forget&quot;</span>
    <span class="n">VECTORIZE</span> <span class="o">=</span> <span class="s2">&quot;vectorize&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;Stop Conversation&quot;</span><span class="p">,</span> <span class="s2">&quot;forget&quot;</span><span class="p">:</span> <span class="s2">&quot;Forget Oldest Messages&quot;</span><span class="p">,</span> <span class="s2">&quot;vectorize&quot;</span><span class="p">:</span> <span class="s2">&quot;Vectorize Oldest Messages&quot;</span> <span class="p">}</span>


<span class="n">VECTORIZERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;text2vec-openai&quot;</span><span class="p">,</span> <span class="s2">&quot;Text2Vec (OpenAI)&quot;</span><span class="p">),</span>
<span class="p">]</span>


<span class="k">class</span> <span class="nc">VectorizerNames</span><span class="p">:</span>
    <span class="n">TEXT2VEC_OPENAI</span> <span class="o">=</span> <span class="s2">&quot;text2vec-openai&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;text2vec-openai&quot;</span><span class="p">:</span> <span class="s2">&quot;Text2Vec (OpenAI)&quot;</span> <span class="p">}</span>


<span class="c1"># Create your models here.</span>


<span class="k">class</span> <span class="nc">Assistant</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">organization</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;organization.Organization&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;assistants&#39;</span><span class="p">)</span>
    <span class="n">llm_model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;llm_core.LLMCore&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;assistants&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">instructions</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">response_template</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">audience</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">tone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">response_language</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">ASSISTANT_RESPONSE_LANGUAGES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
    <span class="n">max_retry_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">tool_max_attempts_per_instance</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">tool_max_chains</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">glossary</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">JSONField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">time_awareness</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">place_awareness</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># assistant image</span>
    <span class="n">assistant_image_save_path</span> <span class="o">=</span> <span class="s1">&#39;assistant_images/%Y/%m/</span><span class="si">%d</span><span class="s1">/&#39;</span> <span class="o">+</span> <span class="n">generate_random_string</span><span class="p">()</span>
    <span class="n">assistant_image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="n">assistant_image_save_path</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">memories</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s2">&quot;memories.AssistantMemory&quot;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;assistants&#39;</span><span class="p">,</span>
                                      <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">context_overflow_strategy</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">CONTEXT_OVERFLOW_STRATEGY</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;forget&quot;</span><span class="p">)</span>
    <span class="n">max_context_messages</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
    <span class="n">vectorizer_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">VECTORIZERS</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;text2vec-openai&quot;</span><span class="p">,</span>
                                       <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">vectorizer_api_key</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">document_base_directory</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">storages_base_directory</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ml_models_base_directory</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">created_by_user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;auth.User&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                                        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;assistants_created_by_user&#39;</span><span class="p">)</span>
    <span class="n">last_updated_by_user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;auth.User&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
                                             <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;assistants_updated_by_user&#39;</span><span class="p">)</span>

    <span class="n">image_generation_capability</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># tools and multi modality</span>
    <span class="n">custom_function_references</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s2">&quot;mm_functions.CustomFunctionReference&quot;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;assistants&#39;</span><span class="p">,</span>
                                                        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_insert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
        <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">AWS_STORAGE_BUCKET_NAME</span>
        <span class="n">base_s3_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">.s3.amazonaws.com/&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Assistant.save] Saving the assistant: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_base_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dir_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;documents/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_model</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_random_name_suffix</span><span class="p">()</span><span class="si">}</span><span class="s2">/&quot;</span>
                <span class="n">full_uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_s3_url</span><span class="si">}{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">s3_client</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">document_base_directory</span> <span class="o">=</span> <span class="n">full_uri</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Assistant.save] There has been an error in creating the document directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">storages_base_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dir_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;storages/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_model</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_random_name_suffix</span><span class="p">()</span><span class="si">}</span><span class="s2">/&quot;</span>
                <span class="n">full_uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_s3_url</span><span class="si">}{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">s3_client</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">storages_base_directory</span> <span class="o">=</span> <span class="n">full_uri</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Assistant.save] There has been an error in creating the storages directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_models_base_directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dir_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ml_models/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">organization</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_model</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_random_name_suffix</span><span class="p">()</span><span class="si">}</span><span class="s2">/&quot;</span>
                <span class="n">full_uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_s3_url</span><span class="si">}{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">s3_client</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ml_models_base_directory</span> <span class="o">=</span> <span class="n">full_uri</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Assistant.save] There has been an error in creating the ml_models directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">force_insert</span><span class="p">,</span> <span class="n">force_update</span><span class="p">,</span> <span class="n">using</span><span class="p">,</span> <span class="n">update_fields</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_parents</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">s3_client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
        <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">AWS_STORAGE_BUCKET_NAME</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Assistant.delete] Deleting the assistant: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">delete_s3_directory</span><span class="p">(</span><span class="n">full_uri</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dir_name</span> <span class="o">=</span> <span class="n">full_uri</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">.s3.amazonaws.com/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">paginator</span> <span class="o">=</span> <span class="n">s3_client</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="s1">&#39;list_objects_v2&#39;</span><span class="p">)</span>
                <span class="n">pages</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="n">dir_name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">pages</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;Contents&#39;</span> <span class="ow">in</span> <span class="n">page</span><span class="p">:</span>
                        <span class="n">delete_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Objects&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;Key&#39;</span><span class="p">:</span> <span class="n">obj</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">page</span><span class="p">[</span><span class="s1">&#39;Contents&#39;</span><span class="p">]]}</span>
                        <span class="n">s3_client</span><span class="o">.</span><span class="n">delete_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Delete</span><span class="o">=</span><span class="n">delete_keys</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Assistant.delete] There has been an error in deleting the directory </span><span class="si">{</span><span class="n">full_uri</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_base_directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">delete_s3_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document_base_directory</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">storages_base_directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">delete_s3_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storages_base_directory</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_models_base_directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">delete_s3_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_models_base_directory</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">using</span><span class="p">,</span> <span class="n">keep_parents</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s2">&quot;Assistant&quot;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s2">&quot;Assistants&quot;</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-created_at&quot;</span><span class="p">]</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;llm_model&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]),</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;llm_model&quot;</span><span class="p">,</span> <span class="s2">&quot;created_by_user&quot;</span><span class="p">]),</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;llm_model&quot;</span><span class="p">,</span> <span class="s2">&quot;last_updated_by_user&quot;</span><span class="p">]),</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;llm_model&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">]),</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;llm_model&quot;</span><span class="p">,</span> <span class="s2">&quot;updated_at&quot;</span><span class="p">]),</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;llm_model&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">]),</span>
            <span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;llm_model&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;updated_at&quot;</span><span class="p">]),</span>
        <span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">generate_random_name_suffix</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Assistant.generate_random_name_suffix] Generating a random name suffix.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1_000_000_000</span><span class="p">,</span><span class="w"> </span><span class="mi">9_999_999_999</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Bimod.io</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../assistants.html">Assistants App Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../organization.html">Organization App Documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Ege Dogan Dursun.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>